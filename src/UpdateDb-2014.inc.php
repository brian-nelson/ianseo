<?php

if($version<'2014-01-15 22:00:10') {
	safe_w_sql("drop table if exists TargetGroups");
	$q="CREATE TABLE IF NOT EXISTS `TargetGroups` (
		`TgTournament` int(10) NOT NULL,
		`TgSession` varchar(1) NOT NULL,
		`TgTargetNo` varchar(4) NOT NULL,
		`TgGroup` varchar(25) NOT NULL,
		PRIMARY KEY (`TgTournament`,`TgTargetNo`),
		KEY `TgTournament` (`TgTournament`,`TgGroup`,`TgTargetNo`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-15 22:00:10');
}

if($version<'2014-01-17 19:40:00') {
	$q="ALTER TABLE  `Qualifications` CHANGE  `QuD1Arrowstring`  `QuD1Arrowstring` VARCHAR( 90 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL , CHANGE  `QuD2Arrowstring`  `QuD2Arrowstring` VARCHAR( 90 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-17 19:40:00');
}

if($version<'2014-01-18 18:32:00') {
	safe_w_sql("drop table if exists Emails");
	$q="CREATE TABLE IF NOT EXISTS `Emails` (
		`EmTournament` int(10) NOT NULL,
		`EmTitle` varchar(20) NOT NULL,
		`EmSubject` varchar(60) NOT NULL,
		`EmBody` text NOT NULL,
		`EmFilter` text NOT NULL,
		`EmSentDate` datetime NOT NULL,
		PRIMARY KEY (`EmTournament`,`EmTitle`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1060));

	safe_w_sql("drop table if exists ExtraData");
	$q="CREATE TABLE IF NOT EXISTS `ExtraData` (
		`EdId` int(10) NOT NULL,
		`EdType` varchar(1) NOT NULL,
		`EdEmail` varchar(100) NOT NULL,
		`EdExtra` text NOT NULL,
		PRIMARY KEY (`EdId`,`EdType`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE  `Qualifications` ADD  `QuSubClassRank` SMALLINT NOT NULL AFTER  `QuClRank`, add index(QuClRank), add index (QuSubClassRank)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-18 18:32:00');
}

if($version<'2014-01-19 11:34:00') {
	safe_w_sql("drop table if exists Awarded");
	$q="CREATE TABLE IF NOT EXISTS `Awarded` (
		`AwEntry` int(10) NOT NULL,
		`AwTournament` int(10) not null,
		`AwDivision` varchar(2) not null,
		`AwClass` varchar(2) not null,
		`AwSubClass` varchar(2) not null,
		`AwRank` int(10) not null,
		`AwValue` decimal(12,2) NOT NULL,
		`AwPrinted` varchar(1) not null,
		`AwMailed` varchar(1) not null,
		`AwReference` varchar(25) not null,
		`AwExtra` text NOT NULL,
		PRIMARY KEY (`AwEntry`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8;";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-19 11:34:00');
}

if($version<'2014-01-20 12:00:00') {
	$q="ALTER TABLE `TournamentDistances` drop primary key ";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE `TournamentDistances` add primary key (TdTournament, TdType, TdClasses)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-20 12:00:00');
}

if($version<'2014-01-29 12:00:00') {
	$q="ALTER TABLE  `BackNumber` ADD  `BnIncludeSession` TINYINT NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-29 12:00:00');
}

if($version<'2014-01-31 11:35:00') {
	$q="ALTER TABLE Qualifications DROP QuRank";
	$r=safe_w_sql($q,false,array(1091));

	$q="ALTER TABLE Qualifications ADD QuClRankOld SMALLINT NOT NULL AFTER QuSubClassRank";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE Qualifications ADD QuSubClassRankOld SMALLINT NOT NULL AFTER QuClRankOld";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE Qualifications ADD QuHitsCalcOld INT NOT NULL AFTER QuSubClassRankOld";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE Individuals ADD IndRankOld SMALLINT NOT NULL AFTER IndRank";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-31 11:35:00');
}

if($version<'2014-01-31 12:25:00') {
	$q="ALTER TABLE Qualifications ADD QuHitsSubClassCalcOld INT NOT NULL AFTER QuHitsCalcOld";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE Individuals ADD IndRankCalcOld INT NOT NULL AFTER IndRankOld";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-31 12:25:00');
}

if($version<'2014-01-31 20:00:00') {
	$q="ALTER TABLE Teams ADD TeRankOld TINYINT NOT NULL AFTER TeRank";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE Teams ADD TeHitsCalcOld SMALLINT NOT NULL AFTER TeRankOld";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-01-31 20:00:00');
}

if($version<'2014-02-04 17:00:00') {
	$q="CREATE TABLE IF NOT EXISTS `QualOldPositions` (
		`QopId` int(10) unsigned NOT NULL,
		`QopHits` int(11) NOT NULL,
		`QopClRank` smallint(6) NOT NULL,
		`QopSubClassRank` smallint(6) NOT NULL,
		PRIMARY KEY (`QopId`,`QopHits`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1050));

	$q="CREATE TABLE IF NOT EXISTS `IndOldPositions` (
		`IopId` int(10) unsigned NOT NULL,
		`IopEvent` varchar(4) NOT NULL,
		`IopTournament` int(11) NOT NULL,
		`IopHits` int(11) NOT NULL,
		`IopRank` smallint(6) NOT NULL,
		PRIMARY KEY (`IopId`,`IopEvent`,`IopTournament`,`IopHits`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8;";
	$r=safe_w_sql($q,false,array(1050));

	$q="ALTER TABLE Qualifications DROP QuClRankOld";
	$r=safe_w_sql($q,false,array(1091));
	$q="ALTER TABLE Qualifications DROP QuSubClassRankOld";
	$r=safe_w_sql($q,false,array(1091));
	$q="ALTER TABLE Qualifications DROP QuHitsCalcOld";
	$r=safe_w_sql($q,false,array(1091));
	$q="ALTER TABLE Qualifications DROP QuHitsSubClassCalcOld";
	$r=safe_w_sql($q,false,array(1091));

	$q="ALTER TABLE Individuals DROP IndRankOld";
	$r=safe_w_sql($q,false,array(1091));
	$q="ALTER TABLE Individuals DROP IndRankCalcOld";
	$r=safe_w_sql($q,false,array(1091));

	$q="ALTER TABLE Teams DROP TeRankOld";
	$r=safe_w_sql($q,false,array(1091));
	$q="ALTER TABLE Teams DROP TeRankCalcOld";
	$r=safe_w_sql($q,false,array(1091));


	db_save_version('2014-02-04 17:00:00');
}

if($version<'2014-02-25 19:50:00') {
	$q="replace into TourTypes set TtId=32, TtType='type_NFAA_Indoor', TtDistance=2, TtOrderBy=32";
	$r=safe_w_sql($q,false,array(1060));

	$q="replace into Targets set TarId=13, TarDescr='TrgNfaaInd', TarArray='TrgNfaaInd', TarOrder=13,
		A_size=0,
		B_size=50,
		B_color='000000',
		C_size=40,
		C_color='000000',
		D_size=30,
		D_color='000000',
		E_size=20,
		E_color='000000',
		F_size=10,
		F_color='ffffff',
		Z_size=5,
		Z_color='ffffff'";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-02-25 19:50:00');
}

if($version<'2014-02-28 08:50:00') {
	$q="ALTER TABLE  Finals ADD INDEX (FinTournament,  FinEvent,  FinAthlete,  FinMatchNo)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-02-28 08:50:00');
}

if($version<'2014-03-02 08:50:00') {
	$q="ALTER TABLE Teams ADD INDEX (TeTournament, TeFinEvent, TeEvent, TeScore)";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE Teams ADD INDEX (TeTournament, TeSO, TeEvent)";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE Teams ADD INDEX (TeTournament, TeEvent, TeFinEvent, TeScore)";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE Teams ADD INDEX (TeTournament, TeFinEvent, TeEvent, TeSO)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-03-02 08:50:00');
}

if($version<'2014-03-07 11:50:00') {
	$q="ALTER TABLE DistanceInformation
		add DiStartDay date not null after DiMaxPoints,
		add DiStartTime time not null after DiStartDay,
		add DiEndDay date not null after DiStartTime,
		add DiEndTime time not null after DiEndDay,
		add DiWarmDay date not null after DiEndTime,
		add DiWarmTime time not null after DiWarmDay,
		ADD INDEX (DiStartDay, DiStartTime, DiEndDay, DiEndTime)";
	$r=safe_w_sql($q,false,array(1060));
	$q="update DistanceInformation
		set DiStartDay=date(DiStart),
		DiStartTime=time(DiStart),
		DiEndDay=date(DiEnd),
		DiEndTime=time(DiEnd),
		DiWarmDay=date(DiWarmup),
		DiWarmTime=time(DiWarmup)";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE DistanceInformation
		drop DiStart,
		drop DiEnd,
		drop DiWarmup";
	$r=safe_w_sql($q,false,array(1060));
	db_save_version('2014-03-07 11:50:00');
}

if($version<'2014-03-08 08:50:00') {
	$q="ALTER TABLE Classes ADD INDEX (ClTournament, ClAthlete, ClViewOrder)";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE Divisions ADD INDEX (DivTournament, DivAthlete, DivViewOrder)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-03-08 08:50:00');
}

if($version<'2014-03-21 16:00:00') {
	$q="DROP TABLE IF EXISTS IskDevices";
	$r=safe_w_sql($q,false,array(1060));
	$q="CREATE TABLE IF NOT EXISTS `IskDevices` (
		`IdTournament` int(10) NOT NULL,
		`IdIp` varchar(15) NOT NULL,
		`IdRegistration` datetime NOT NULL,
		`IdLastSeen` datetime NOT NULL,
		`IdDevice` varchar(255) NOT NULL,
		PRIMARY KEY (`IdTournament`,`IdIp`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8;";
	$r=safe_w_sql($q,false,array(1050));

	db_save_version('2014-03-21 16:00:00');
}

if($version<'2014-03-22 14:00:00') {
	UpdateWinLose_20140322();
	db_save_version('2014-03-22 14:00:00');
}

if($version<'2014-03-30 11:00:00') {
	$q="ALTER TABLE `TargetGroups` ADD `TgSesType` varchar(2) NOT NULL DEFAULT 'Q' ";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-03-30 11:00:00');
}

if($version<'2014-03-30 12:00:00') {
	$q="ALTER TABLE `TargetGroups` drop primary key";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE `TargetGroups` add primary key (TgTournament, TgSession, TgTargetNo, TgSesType)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-03-30 12:00:00');
}

if($version<'2014-05-04 15:35:00') {
	$q="ALTER TABLE `ACL` DROP AclAccess";
	$r=safe_w_sql($q,false,array(1091));
	$q="ALTER TABLE `ACL`
		ADD AclEnabled TINYINT NOT NULL DEFAULT 0,
		ADD  AclFeature TINYINT NOT NULL DEFAULT 0,
		ADD  AclFeatureExtra VARCHAR(50) NOT NULL ,
		ADD  AclLevel TINYINT NOT NULL DEFAULT 0";
	$r=safe_w_sql($q,false,array(1060));
	db_save_version('2014-05-04 15:35:00');
}

if($version<'2014-05-18 19:00:01') {
	$q="ALTER TABLE DistanceInformation
		add DiType varchar(1) not null default 'Q',
		add DiDay date not null,
		add DiWarmStart time not null,
		add DiWarmDuration int(5) not null,
		add DiStart time not null,
		add DiDuration int(5) not null,
		add index (DiDay, DiStart, DiDuration),
		add index (DiDay, DiWarmStart, DiWarmDuration)";
	$r=safe_w_sql($q,false,array(1060));
	safe_w_sql("update DistanceInformation
		set DiDay=DiStartDay,
			DiWarmStart=DiWarmTime,
			DiWarmDuration=TIMESTAMPDIFF(MINUTE, concat(DiStartDay, ' ', DiStartTime), concat(DiStartDay, ' ', DiWarmTime)),
			DiStart=DiStartTime,
			DiDuration=TIMESTAMPDIFF(MINUTE, concat(DiStartDay, ' ', DiEndTime), concat(DiStartDay, ' ', DiStartTime))");

	$q="ALTER TABLE DistanceInformation
		drop DiStartDay,
		drop DiStartTime,
		drop DiEndDay,
		drop DiEndTime,
		drop DiWarmDay,
		drop DiWarmTime";
	$r=safe_w_sql($q,false,array(1060));
	db_save_version('2014-05-18 19:00:01');
}

if($version<'2014-05-21 12:30:02') {
	safe_w_sql("drop table if exists FinWarmup");
	$q="CREATE TABLE IF NOT EXISTS FinWarmup (
		FwTournament int(10) NOT NULL,
		FwEvent varchar(4) NOT NULL,
		FwTeamEvent int(1) not null,
		FwDay date NOT NULL,
		FwTime time NOT NULL,
		FwDuration int(5) NOT NULL,
		FwMatchTime time not null,
		FwTargets text not null,
		FwOptions text not null,
		PRIMARY KEY (FwTournament, FwEvent, FwTeamEvent, FwDay, FwTime),
		UNIQUE (FwTournament, FwEvent, FwTeamEvent, FwDay, FwMatchTime)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-05-21 12:30:02');
}

if($version<'2014-05-23 16:00:00') {
	$q="ALTER TABLE Scheduler
		ADD SchDay DATE NOT NULL,
		add SchStart time not null,
		add SchDuration int(5) not null,
		add SchTitle varchar(255) not null,
		add SchSubTitle varchar (255) not null,
		add SchText varchar(255) not null,
		add index (SchTournament, SchDay, SchStart)
		";
	$r=safe_w_sql($q,false,array(1060));

	safe_w_sql("update Scheduler
		left join Session on SchTournament=SesTournament and SchSesOrder=SesOrder and SchSesType=SesType
		set SchDay=date(SchDateStart), SchStart=time(SchDateStart), SchDuration=TIMESTAMPDIFF(MINUTE, SchDateStart, SchDateEnd), SchText=SchDescr, SchTitle=SesName
		");

	db_save_version('2014-05-23 16:00:00');
}

if($version<'2014-05-25 11:10:00') {
	$q="ALTER TABLE `Events`
		ADD `EvTargetSize` INT(11) NOT NULL DEFAULT 0 AFTER  `EvFinalTargetType`,
		ADD `EvDistance` VARCHAR(10) NOT NULL AFTER `EvTargetSize`";
	$r=safe_w_sql($q,false,array(1060));
	db_save_version('2014-05-25 11:10:00');
}

if($version<'2014-05-25 18:15:00') {
	$q="ALTER TABLE Scheduler
		drop PRIMARY KEY";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE Scheduler
		ADD PRIMARY KEY (SchTournament, SchDay, SchStart, SchOrder)";
	$r=safe_w_sql($q,false,array(1060));
	db_save_version('2014-05-25 18:15:00');
}

if($version<'2014-05-30 12:15:00') {
	$q="ALTER TABLE `Events`
		CHANGE  `EvDistance` `EvDistance` SMALLINT NOT NULL";
	$r=safe_w_sql($q,false,array(1060));
	db_save_version('2014-05-30 12:15:00');
}

if($version<'2014-06-15 18:34:00') {
	$q="ALTER TABLE `Scheduler` ADD `SchShift` int(4) NULL default null";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE `DistanceInformation` ADD `DiShift` int(4) NULL default null";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE `FinSchedule` ADD `FsShift` int(4) NULL default null";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-06-15 18:34:00');
}

if($version<'2014-06-19 16:36:01') {
	$q="ALTER TABLE FinWarmup drop key FwTournament, add index (FwTournament, FwEvent, FwTeamEvent, FwDay, FwMatchTime, FwTime)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-06-19 16:36:01');
}

if($version<'2014-06-25 19:00:04') {
	safe_w_sql("drop table if exists IdCardElements");
	$q="CREATE TABLE IdCardElements (
		IceTournament int(10) NOT NULL,
		IceOrder int(4) NOT NULL,
		IceType varchar(25) not null,
		IceContent blob not null,
		IceMimeType varchar(25) not null,
		IceOptions text not null,
		IceNewOrder int(4) NOT NULL,
		index (IceTournament, IceOrder)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-06-25 19:00:04');
}

if($version<'2014-07-01 08:00:02') {
	$q="CREATE TABLE if not exists IdCards (
		IcTournament int(10) NOT NULL,
		IcBackground blob NOT NULL,
		IcSettings text not null,
		primary key (IcTournament)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-01 08:00:02');
}

if($version<'2014-07-18 19:00:00') {
	$q="ALTER TABLE FinWarmup drop primary key, drop index FwTournament";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE FinWarmup add primary key (FwTournament, FwEvent, FwTeamEvent, FwDay, FwMatchTime, FwTime)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-18 19:00:00');
}

if($version<'2014-07-18 19:45:00') {
	$q="DROP TABLE IF EXISTS `ACL`";
	$r=safe_w_sql($q,false,array(1051));
	$q="CREATE TABLE IF NOT EXISTS `ACL` (
		`AclTournament` int(11) NOT NULL,
		`AclIP` varchar(15) NOT NULL,
		`AclNick` varchar(50) NOT NULL,
		`AclEnabled` tinyint(4) NOT NULL DEFAULT '0',
		PRIMARY KEY (`AclTournament`,`AclIP`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1050));

	$q="CREATE TABLE IF NOT EXISTS `AclDetails` (
		`AclDtTournament` int(11) NOT NULL,
		`AclDtIP` varchar(15) NOT NULL,
		`AclDtFeature` tinyint(4) NOT NULL DEFAULT '0',
		`AclDtLevel` tinyint(4) NOT NULL DEFAULT '0',
		PRIMARY KEY (`AclDtTournament`,`AclDtIP`,`AclDtFeature`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1050));


	$q="CREATE TABLE IF NOT EXISTS `AclFeatures` (
		`AclFeId` tinyint(4) NOT NULL,
		`AclFeName` varchar(50) NOT NULL,
		UNIQUE KEY `AclFeId` (`AclFeId`),
		UNIQUE KEY `AclFeName` (`AclFeName`)
		) ENGINE=MyISAM DEFAULT CHARSET=utf8";
	$r=safe_w_sql($q,false,array(1050));

	$q="REPLACE INTO `AclFeatures` (`AclFeId`, `AclFeName`) VALUES
		(3, 'MenuLM_Accreditation'),
		(4, 'MenuLM_Athletes Sync.'),
		(1, 'MenuLM_Competition'),
		(6, 'MenuLM_Eliminations'),
		(7, 'MenuLM_Individual Finals'),
		(0, 'MenuLM_Modules'),
		(10, 'MenuLM_Output'),
		(2, 'MenuLM_Participants'),
		(5, 'MenuLM_Qualification'),
		(9, 'MenuLM_Speaker'),
		(8, 'MenuLM_Team Finals')";
	$r=safe_w_sql($q,false,array(1050));

	db_save_version('2014-07-18 19:45:00');
}

if($version<'2014-07-20 11:00:00') {
	$q="ALTER TABLE  IdCards CHANGE  IcBackground  IcBackground LongBlob NOT NULL";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE  IdCardElements CHANGE  IceContent  IceContent LongBlob NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-20 11:00:00');
}

if($version<'2014-07-27 09:05:00') {
	$q="ALTER TABLE  `F2FFinal`
			CHANGE  `F2FArrowstring`  `F2FArrowstring` VARCHAR( 36 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
			add  `F2FSetScore` tinyint not null,
			add F2FSetPoints varchar(36) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-27 09:05:00');
}

if($version<'2014-07-28 08:00:00') {
	$q="ALTER TABLE `F2FFinal`
		change F2FSetPoints F2FEndPoints varchar(36) CHARACTER SET utf8 not null,
		ADD F2FMatchPoints varchar(255) CHARACTER SET utf8 not null,
		ADD F2FHits tinyint not null,
		ADD F2FTieBreak tinyint not null,
		ADD F2FTieArrowstring varchar(3) CHARACTER SET utf8 not null,
		ADD F2FTieScore tinyint not null";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-28 08:00:00');
}

if($version<'2014-07-28 12:00:00') {
	$q="ALTER TABLE `F2FEntries` ADD F2FHits tinyint not null";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-28 12:00:00');
}

if($version<'2014-07-29 10:00:00') {
	$q="ALTER TABLE `F2FFinal` ADD F2FLive tinyint not null";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-07-29 10:00:00');
}

if($version<'2014-08-06 19:20:00') {
	$q="REPLACE INTO `LookUpPaths` (`LupIocCode`, `LupFors`, `LupPath`, `LupPhotoPath`, `LupFlagsPath`, `LupLastUpdate`) VALUES
		('CAN', '', 'http://can.service.ianseo.net/IanseoData.php', '', '', '')";
	$r=safe_w_sql($q,false,array());
	db_save_version('2014-08-06 19:20:00');
}

if($version<'2014-08-07 10:00:00') {
	$q="ALTER TABLE  `Events` ADD  `EvMedals` TINYINT NOT NULL DEFAULT  '1'";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-07 10:00:00');
}

if($version<'2014-08-10 17:00:00') {
	$q="update `Flags`
set FlSVG=0xbd575b8f9b46147ecfaf40e4b13bc3dc18c0b11d355d6d55a97d4913e5b1c230b6e962c6026cefe6d7f7cc70317871b66aea20adec739b73ce77be3966e7ef9f76b973546595e962e1524c5c4715894eb362b3703f7f7a40a1eb54755ca471ae0bb5700bedbe5fbe9957c7cd1bc77120b8a86669b270b775bd9f79defe50e658971b2f4d3c95ab9d2aeacaa3987aeed93d39bb27a58aebeca812bddbe9a2b29145f576e05ca6ebdefb743ae113b74e348a228f308f31041ea87a2eeaf8098d43a1c6a9504608f1c076f6fc775eb30a50d9c35fefde2970a50f65a2d610a770a16aeffed37d6f4404a7753a38262b1eab24deab51d64ed92010ef54b58f1355799ddec61f3375faa09f162e718823892388559fb2b4dec2eca0642b6f55b6d9d60b376ce52c5db8d0096bce388f9a36d636c3acb7102c422c9c328a78645dba5666a94e4c6d102cfefaf2f9e75fd0438ee064f4eb878fd860b504eff94ed5711ad7b1896c92771a46ad07f8c0cc661fef1f1a09e424997dd1e5632bc2631ce2953e401beeb257cfd3640628efe27a99ede28d3203fa09509d7b67c3c8b97edeabf3a1cdb1a56ac635c9d934d96526c8fbb3cef2fc3793c475bc8b43b33a574b9bb3f9da75e1b56db44d7a832ee75e07829552b5aecef81889466d9e798fb6813a35336f3cf7504ba2735d2edcb76bfbb88d61a5cb54959d49da6764d2c025e80ac6d6aaf5ea6f95d4b5ce55191706094a5acba604324de90f59aaa60c3d7d4c797da2496bb58d537d5ab8ecd278ca0a30a096c752902b0e1db145d87b007a3d4c3468b5d5569f4c230b771de7951a6a4d1b70dfebf2a02e93581b5aadcc059bb27fd57a672e4710fa97a604422479517602488809f5a12c612fa23c7e56e5e06a0e5caa22dea34dae57713e5d8c7530a0b6e6963bfbb8deb6ddd6cf3918db89cce8bb35f079d612c70a686c43e52157337554854ed377555dea47352b60e7b7a901cd3f1c72479cdf61f5741fc27cda8faf838994402e4ed88bae125d1460d22502088e717d2895a1cab5da9b8a9335156cf51d155389a340fadcb7a53286a350705f82c4c0128594b22b5adb1d3726d8add1a5388c91e4521c663dc74c6bc928eb581a577f962ef16661d0d3bf5f201aee2c2c33207c327c5e419c102682f43f234e7d1cd28086e11d15502d635c3424c1421080a86964609a0a18b667cae41127b72d9b416ee94761704719669c85949b41f45acb78ec47cc17a1df0c6922e265ddc1cd09dedc41668a91ccf0840696597e83270d03a3047e0a3f080da5065a133d4525249044ecb6880b8169c8fa8a5a36c81153e4982a532153544137260bf731e182503e22cb598b844201687c8e398bfcd0ce682a688a2f88be72916f4ba876bbf300fb02c0f64703e87a10d7b41c4b0157c436ef63612829cf3f1a57a9461043afefaf1fb3b8823b06fdb02090d2de10e8cef723421b69689b8a98a4a3f8be89fe4fab4ddeb10007d2143c585fb2f961eb761b6fc4a99849b286b75e6f4d39fdf6b2489bedd6172919bfa69598db28b33ab0cf050f04ffc64bcb888ee2c76c3f3a62941cd34d8ef9361533cdb71baf6e0e10fb12063b62d4596b21ee975ff3e2341132492872f3f526da7d042b8e184e18d20886099424a21195ec1264e6d564a895df260f43d2b63037ff9e2edffc03
, FlJPG=0x2f396a2f34414151536b5a4a5267414241514541534142494141442f3277424441414d434167494341674d434167494441774d44424159454241514542416747426755474351674b43676b4943516b4b4441384d4367734f43776b4a4452454e44673851454245514367775345784951457738514542442f3277424441514d4441775144424167454241675143776b4c454241514542415145424151454241514542415145424151454241514542415145424151454241514542415145424151454241514542415145424151454241514542442f7741415243414346414d67444153494141684542417845422f3851414867414141774541417745424151454141414141414141414141634a4341514642674d4b41514c2f7841424c454141414241514441774d5043674d4a415145414141414241674d454141554745516349495249554d516b6951524d5646686b6a4d6a6843555665556c6254533078673351314a5759584a326862566959354d584a444e545a48467a6459476a4e502f454142304241414943417745424151414141414141414141414141594841416744424155434351482f7841424745514142415155444267595043414d4241514541414141424167414442415552426a4652427849685158477846794a53595a4c52457851574e44565456474a796334476873744c7746544e435a4a47543465496a4d7348786f734c2f3267414d41774541416845444551412f414f3579395a346134777133616d61363369714b5754736d51447158657369634f354b47486e6c41506f7a6a304142544644534b4a5964346d3050697254366454554a554465614d6a3242545947797142376434716d504f544e397767486c433457474d4a34345a466c5570622f614c6c336d524b6d7031326c765a4a616b344b757356495175426d796f43494f435734426662345745346a475a364678437237434771416e7448546c374a5a6f314f4b53354c57413441504f5357534e6f634c6871557761443542434f45694a66774375785241715071377161784578736e5a2f4b44446d5a794234486237574c675467744e365365554e42306e6a58745a2b6379575556464b6e556a6e387261544b58506b6852637448614a5655566b78346c4f517743426748794345546e7a54636c7a2f415073726a4c5750316c6c3656644c662b6a756178782f2b61672b57782b4249304e6c367a795554696c75314d562f75314c315165795a4448505a6939503841797a6d48755a684878446a35414178684730616667716c453766774b757a5161394773616a7448305751646f4c4e525573666d446d6a6f6f554c6a694d556d346a5a37644c666e426e4d6c6e464f7a563149702f4b3363746d4c465555584c5232695a4a5a46514f4a546b4d41435551386768484369373259334b4c68486d566c516856737136333143696c734d7167596b4b56326a6276536e36466b372b49666863646b53694e346b6c6d51796759755a61706d593955537a726e54617175777a71466751786d71742b394b70306f4b4439512f456237496d414c77324a4e6157466d774473385235795472324858737659426a4a6139684f4d4e4b6365746b644242424247334f59676767694e47712f7952487a4831682b617a2b78743452576548776f71312f5476323574443135496a356a36772f4e5a2f59323849725044345556612f703337633269763175752f6e76704463316b73672f68525871566647375a46512b636a50685155662b43592b774f495130506e497a345546482f676d50734469416d472b2f52744739724432733841787671586e77466e6a79752f7a48306638416d736e7362694a5152562f6c642f6d506f2f38414e5a5059334553676978316a76425364717437665071636439485947494949494b57356245454550664c586b3378637a4c54456a696e7066316e70644e54596431432f544d44596c68357855533643756f48315336414e746f7862674d59496d4a63776a73765836676c49316c736a74327436724d514b6c6b764961666e6c557a687054314e5368354e4a6f2f554246717a5a6f6d5657574f5041705346415245596f56674a79645648596279496d4c32634f654d57544e6f4256795539764941676d504570585370427571636568464b3978414145787269534765684d3873484a2f534e656d38505a57537263526c6b657050586168796e63375138515857414242756e657739525444614778646f50486a49324c4f4e5749654e55394765563350447551544564315a4a58493161464878556b3732446f7559626d47775845595574704d6f436c566835666f474f762b4e2b786e62595449394854374e6a4a682f6a6333314930713945472f306a78634d356e336a6c6e6d6d55336c3434653443532f73527064716e75684869435255484b695251734255434530624a32346250507462556d70597a70682f687658654c6453467036695a47366d3877574862574d58764569694f71697168756151742b6b77366a6f4678473050584c316b627262464c64716e72376561587063396c4341636c6e7a306e48755a4442334d6f68343577386767557744654b49596534613054685a5479564d554a5437615673553743634577756f7365317474513438355133336d45664a773068646f6858386572737351644831637a636d647235425943474d73732b37537439724e344278577139523830476775716d356b566c36795055506856753154563175395556536e5a51676e5475795a48343979544d48504d412f5348446f41536c4b4f734561526d73326c63696c726d637a755a4e5a65775a4a6d5763756e5378556b55557743346d4f63776742514479694d4564324867794530636f4a484d4b736970766147506e45535971506646537a7a30414741467747786f5a5a627334574c6d57715a4554706d5a64646161565632336c5050314447617158486e47534869676f50316936434e746f706743306239596e7975636f52496c4a76536a384b557848515132334342796b4b39494942613671594342586149614231516f3751427367496b37324a48787a5a4c4f357a546332617a366e7071376c6b7959714173326474466a4a4c496e446759687969416c48377747484650624c51633653564b4761764848614e653239676551326c6d466e59684d524250436b6a412b376e47494e516347315a6a46674e695067664f65746c6253595374566a69566e4d32397a74485942395139744457346b4d4147447957734d4e624c316e66726e436a64715a7266654b6f705a4f795a43714b58657369634f34714737386f423947636261414254464350766c383553436e4b7a6b78634a63336b6d5a7a4b587643466242554f3641644a514f6a664553686f4944394d6d476732455368595478364847374977594a582f61506c306d5a4b6e7078346c76616374526346634b676b4f6f47624b674967344a6267572b3377734a7847456c4e374f78396e333161476d6f6a534473783258387a5764732f6c476b4e76495153793061457057626c48516d75494e36466339614848545274313464596e304e69765479645455485544655a737a57425143447371747a323778564d6563513333434776454c687248657a655553716679787a4a5a374c4773786c373149794c6c7136524b7169736d4f676c4f51774342674879434552656f664543766349366f436530664f58736b6d725534704c454142414432486e4a4c4a6d304f4677314b594f496555496f586c367a7a5556696875314d596862745446546e736d51356a374c4636666f366d6377397a4d492b4963664941474d49326a4443544a4c30684b2b4b706865313254434f6b6756465336723578663536527a67586a6e4874414449484e4e79584b61322b56786c7345457a38355a656c584b334e4e306a75697878302f343142747873634e43784f4b64794f64557a4e6e5567714b5575355a4d6d4b676f75576a74457953794a77346c4f5177414a522f336a3948734a624d586c4b776a7a4b53675571786c4f355435424c59597a39695570486a6679464d5042564f2f694875476f37496c456277795a4c624237445563782f475479767844626a7632736b59325470656364786f4f47722b4767374244307a4a5a4f38584d7455794f74556b75363755797170734e4b68594a6d46737063656156554f4b43672f564e6f493332544774654558444a68346c7a46757739634b436b6e574748486a746270575973554c566635496a356a36772f4e5a2f59323849725044345556612f70333763326836386b5238783959666d732f73626545566e68384b4b7466303739756251686264642f506653473572485a422f43697655712b4e32794b683835476643676f2f3841424d665948454961487a6b5a384b436a2f774145783967635145773333364e6f33745965316e67474e3953382b4173386556332b592b6a2f414d316b396a63524b434b76387276387839482f414a724a374734695545574f7364344b54745676623539546a766f37417848506b4d676e6c557a687054314e5368354e4a6d2f554246717a5a6f6d5657574f504170534641524559644757764a7869356d576d4a484650532f72505336616d773771462b6d5947784c447a696f6c3046645150716c3041626252693341593367684e4d73484a2f7952656d73504a57537263523155657050586170796e6367627042645941733354767231464d4e6f62463267386550326532716735496b704a7a6c345962542f793974367a396c356a61534a5444514c73714a7777787741357a5163374c4441586b36364e77326b4a4d587334633959736d625143726b7037655142464d654a53756c534464553439434b56376a59424d61346c6a736363733873796e457648443741575839694e4c4e553930493851534b673556534b46674b69516d6a5a4f33445a353972616c314c434678597870784478706e6f7a797535346f3532424864575356794e57685238564a4f3967364c6d4735687346784748506c36794d317269687531543467377a54464d48736f516869576650536679794744755a5244787a68354241706747384a4f6257686d466f483143545443344471336e46725053444a375a2f4a2f43435a3267576c54775841365531774176577232554639425372496e44374453764d584b6b4c543145534e314e6e366f376178772f773053694f7169796738306862394a683148514c6a704645637657534368734b4e3271617439337169716b374b454d6f6e646b79507837696d62767a4150306877766f416c4b55596575482b473946595855386c544643302b326c54424f776d4b6b467a7248746262554f504f554d506c4d496a30634e49376d63546955302f4b3355376e307a617936584d6b6a4c4f5862705971534b4b596354484f5951416f423552474d554a4c55756943726a4b595374666c4f6a7036465173425679342f77447051383469346561506153334d684b5a6a4d322b4565577555696572357476384150316b74746c49474a696e654c3337307877344970333863397541374947454c526b664e50796f78436235512b5777414d626e49754b71636f3642304475694a77312f354641387469446f614a795471647a6d704a73366e31517a56334d356b2b55465a79376472475657574f5045787a6d45524d5033694d4d6d53324f65784e4830667855386e3852323462396a4a4f4e6e435866456361546a712f6c6e4e6d527a6859755a6c5a6b5a4f70706c317170704a58625a3038774f5972564f773830796f385631412b7362514276736c4b413267684751517959654763776a734f6e43516c493142687834385739566e724e537842424247647362454f2f4c686d397863793154516f55724d2b75564f4c4b3762326e33357a47614b333734796653696f50317963527474415941744351676a4445517a714c646c302f53464a4f6f7437647646756c5a36445174573658754d72664b45794d387a706c36576b735355554e7477334f5568587052414e52555441514b385244547568523267445a754a4f396a4a574d654132492b423035363256724a684b31574f4a57637a62334f30646748314432304e626951774159504a6177786c4b547a6d6230394e4773386b4d3064793659736c4157624f3269786b6c6b5641344749636f674a524479674d5547792b6370444961746b78634a7333636d617a575750434132436f643042516867364e38514b48455038354d4c674941496c7663384b65306d543836596958365268722f414a333757644e68637238665a38706849372f4934774a306a305471324869345a743766484c316e647272435864715a7250654b6e70564f795a5531464c7647524f48635644643855412b6a4f4e7441416f6b69696d48474b4e433473302b6e5574423141336d54513167564b55646c567563513778564d6563513333434776454c6872474673624d6a51486c51596b35635a6f6e56464f50457436546c714c67726855456831326d716f43494f43655174397653774363597a4c524e653135684a564154326b4a77396b6b326148464a596f414a64717738354a5a4d32687933445570674855504b454c68455445533966596f6756483164314d344a6a5a537a2b554b484d7a6b44774f33313546774a77576e384a504b476733385a725354535653796553357a4a35314c6d7a396738544d693461756b6971704c4a6d43776c4f5177434267454f675169647561626b756d3776664b347932435675747a6c6e464b7556724a6e48694f364b6d486d6a2f4c554733477869324173506a4c316e6f6f764533647158784633616d4b6d505a4d69706a374c4236662b413568376b59523851343234574d496a614e535155796964763446585a6f4e656a574e52326a364f44494f304e6d597156766a427a5230557131484559704e784830577846795530676e6c4c595431335431537968354b356d7771395246797a65496d5357524f444e7663706947414241663841654d3935346643697258394f2f626d3056654969696d6f64556952436e56734a7a4155414531677346783664496c446e68384b4b74663037397562527a4c5478686d4331524a464d35514e50597a4a79494f65313579386431725279723433624971487a6b5a384b436a2f7754483242784347683835476643676f2f384578396763514c773333364e6f33745943316e67474e3953382b41746f446c575a42504b70776e6f536e71616c447961544e2f5636614c566d7a524d7173736357626978536b4b416949777163427554736f334461516b78657a687a3169795a74414b75536e643573696d6269557270556733564f5051696c653432415447754a5932786d5678306c754146447436766355366163544230373347576f375145495263795a7a62527a6a71557579516237494349364270653453397858786f784478706e777a327535346f3632424864576156794e57685238564a4f3967364c6d47356873467847443137612b496c6b434a66446144704a4f76547a36765a703577315837485a4c4831726e33326a45717a4965744b336b307643522f303642675766574f5765535a7a6d58446839674e4c2b78436c6d71653645646f4a465163717046437746524b5452736e62674265666132706453786e6a447a444b766358716b4c543145534a314e58796737613667614a6f46456456466c423570432f6549366a6f46783068385a6573693961596d377456474975383078544a374b45534d545a6676536677454d48636969486a6e432f437852416278513667634f614c77767039476d4b467039744b6d43576f6c534c63367037573231446a7a6c444439597769502f414a416f6946667879757978426f4761557a7468494c4177786c646e6e6156765265627744697456366a356f4e4264564e7a497a4c316b696f58436264716c725464366e71704f7968564645377332522b5063557a643859422b6b4f463941456f45474e4c787770314f3550546b716454326f4a71306c737459706973356475316970496f7068784d63356841436839346a45356330334b6a4362664b48793242594f6369347170796a7235423352453466384130554479324a774e42584b4a492f6a3164686730614e5a314461666f7367702f61534a6d5438786b7a656c617a647a6379526342736f47317a6d4f7a655952356170576273726d6e58476f6c6b39746c54374535544f31723936592f51696e2f41426e3432485a417768614a49356a3833754c6d5a5761474371706e317470784658625a552b774f5972524b33656d5536566c412b7566674e396b43674e6f546b346e4d337147614f703550706f376d4d7865714373356475316a4b724c4b44784d633568455443506c455934634e65545761685a534138504865636f36746731626232416f795a50597669334a773632494949494932357a45454545526f3179506b425a51664d724c2f5744333430487941736f506d566c2f72423738614a6a646d315a2f613664656e712b39423262566e39727031366572373056743772593378692b6d57746677442f414a6c48376638415a71632f494379672b5a57582b734876786f506b425a51664d724c2f414667392b4e4578757a61732f74644f765431666567374e717a2b31303639505639364a335778766a46394d744f416638796a39762b7a55352b51466c423879737638415744333430487941736f506d566c2f72423738614a6a646d315a2f613664656e712b39423262566e3972703136657237305475746a66474c365a6163412f356c483766396d734a68646772687267764c334d6f7779703553534d485a2b71714e43544279736874394a69707171474b517739496c4142477758765949344663356463464d535a794e51317068374c70684d6a45416833514755525555414f47324b52693759687741545847326e434a46646d315a2f613664656e712b39423262566e397270313665723730614c36633973714b6e79536f6e4531337476775752794f6c79732b446d48597a64564b536b3077304c4456542b52706c6e3831544c30313138574772544e4e53656b4a4b32703651494c4953396d5859515356637172696d546f4b426c54474e736877414c32414e417445562b7a61732f74644f765431666567374e717a2b31303639505639364d534a6d3652705337702b6e55327a46354b4a764d456845584e4650414e49436770517237566c7265524a375044345556612f70333763326853646d315a2f613664656e712b39485750487a32597554764a673757644f464c62617179676e4f61775743356831485141442f794d455a48694b5145424e4e4e57494c45354f336c6b5a67754e584542356e494b4b424e4c314a4e6131504a39376643487a6b5a384b436a2f77544832427843476a37736e7a32577553504a633858617545373743714b676b4f57345747786731445152434e4630767361307277494c4d4762774a6d6376667749566d6c3468536133307a6b6b56707a56613075496546744259725374744a63516164536e444a6f343370464a5256524d434b37496c3272706d4b504178673432316a796c4d355773763841534536625644494d4d5a59684d475a74744256553679344a6e364441565535693751635147317748554c524a6a7332725037585472303958336f4f7a61732f74644f76543166656a716d5a756c484f4c7654374f706b383579557a6547634747637a5253585a72785146424f6d2f51463030363274354245512b7a61732f74644f765431666567374e717a2b31303639505639364d6e32774f52372f414f47352f416b2f38744851507a4e5954464842584458476958747052696254796b37594e4439565461486d446c4644623644475453554b55356736424d416946787461347774506b425a51664d724c2f57443334305447374e717a2b3130363950563936447332725037585472303958336f32335670346c776e4d644b556b59425241397a595635436c50446e4c696b6b2b722f73314f666b425a51664d724c2f5744333430487941736f506d566c2f72423738614a6a646d315a2f613664656e712b39423262566e3972703136657237305a4f36324e385976706c765041502b5a522b332f5a71632f494379672b5a57582b734876786f506b425a51664d724c2f57443334305447374e717a2b3130363950563936447332725037585472303958336f6e6462472b4d5830793034422f7a4b50322f374e546e35415755487a4b792f3167392b4e424578757a61732f74644f7654316665676964317362347866544c5467482f41444b50322f374e307345625337575657486e546b33713958336f4f316c56683530354e3676563936422f74434a354f356d6c776a3258387248525838725974676a6158617971773836636d3958712b394232737173504f6e4a7656367676524f30496e6b376d6e43505a66797364466679746932434e7064724b72447a707962316572373048617971773836636d3958712b3945375169655475616349396c2f4b7830562f4b324c5949326c32737173504f6e4a76563676765164724b72447a70796231657237305474434a354f3570776a3258387248525838725974676a6158617971773836636d3958712b394232737173504f6e4a7656367676524f30496e6b376d6e43505a66797364466679746932434e7064724b72447a70796231657237305a69786c777965594f596b7a6a44682f4e555a6b764b4e333233534b596b49703156424e594c46473468594641442f794d6232466575526e5045304464575557736b302b666d476c7a384c57426e45414b47674543756b44575133696f494939746778686538786c78486c57484d766d714d74586d6f4f424b3557544535436453514f714e796749434e775445503841324d4b556c5a4355336c753346524c7143634c6958356f68414b69634142556e324276457752744c745a565965644f5465723166656737575657486e546b33713958336f327530496e6b376d442b4565792f6c59364b2f6c62467345625337575657486e546b33713958336f4f316c56683530354e36765639364a326845386e63303452374c2b566a6f722b5673577752744c745a565965644f5465723166656737575657486e546b33713958336f6e61455479647a546848737635574f69763557786242473075316c56683530354e367656393644745a565965644f54657231666569646f52504a334e4f4565792f6c59364b2f6c62467345625337575657486e546b33713958336f4f316c56683530354e36765639364a326845386e63303452374c2b566a6f722b5673577752744c745a565965644f5465723166656769646f52504a334e4f4565792f6c59364b2f6c5a536474337878383239432f30336e78344f323734342b6265686636627a343859546769792f63334b76456a333962554d2b3059726c6c74326474337878383239432f77424e3538654474752b4f506d336f582b6d382b50474534496e63334b76456a33396254375269755757335a32336648487a62304c2f546566486a7336613556444d6e5755385a307a536d446c4a54656176314153624d326256367171716279415571312f7645656741455268425a5a736c4f4c655a4e346c4d5a597a4751556956545a6356412f53487152674162474b334a6f4b352b5041514b41685978693658725a6c39797559535a62704831766f4b5267704e463077492f6e62774155664f78365145397559532f424d674158514273493345526d63726b4d717137513543336d414a6f4e70723772396a644b4445664663597249546a314e334f4372374857625579453378326c644b53656175674b644b56534d7178786146365157574f7163706a2f414d4a41325174337872364d53503449674158456241455a567a433537614f7735336d6c734d743171616f7958545564416261594d6a394e7a46487578772b71556242306d75416c6862785555684a4c316445673668754447386a6b4d66505834684942425772576451474b6a63422f344766754a6d4b39423451302b65704b396e364576626167696c3379376b344233695359633435754844514f496941617869697075557572513836636a523248306b536c41477332435a6d5655636d4b486a48464d3553674938646b4c323458486a475536777261757356366f4e504b736d3736657a683663456b396f424d4f6f38314a4a4d6f574b467830495541445868476e4d47736b4464684a54596e5a6c70776a53314e73553936556c71376b726451557731753556455142416f366377423278766135423048696474524d61387a4959552b7672517a7563324c737a596d413762744b7350586846326d6d78435151547a714f6a3057314a6c4d78337162482b694a74564654796557793564684e544d45794d4371415178415254506364737868766334686f506b6a422b6548776f71312f547632357446417374654d47456d4c4e4d546448424f56433070656c5a6b4d6d626e4b31427369344d43524642555354373759487167616e41444747346948534d2f633850685256722b6e66747a614e6d627737364663687a4566376769746468626b5a4c4979446a3756525554414f2b78756c4f6c5a7161316f4d39337239374971487a6b5a384b436a2f7754483242784347683835476643676f2f3845783967635277346237394730623264647250414d62366c353842617273645855784b6e504a58495563764b307075426274686d614b696a5978673855344a6d4b59414868744265334777384938466a646d4b7738792b71307974695375365a7979706e796b764a4d456b75714a7446436b32674d71554f6473447146796749674e7268613467784a4c4f3550556371617a326e3571306d5574664a41733264744669716f724a6a774d513552454442393444426f75486570646836704a4356566f6452706670616c4c70386c4c7a52516c4e4e42302f714d477844695a6e567a4c34513141656d3639776e7065587564525256366d354d67354941392b6b6f4375796376446871484151416449343248334b557a56576f556d324a3945533947544c57495a7a4a75716457626a667678496f63774b46386f414a5236517677486164645966306469565436394c3178494773326c792b6f70724635795a75673544427a6948446f4d5551474a363568636956593463377a564f475739564e54684c714b4e674c745032525034696c447578412b73514c68306c73416d6a68784b597477633932724f444f717938585979304c7674475a517158443836416f4651535435704a3470356c56484f6130625a74643467346c3154683268587556647a5256586d325448466a4d78574c7651414639684e55697041535644674b61705131485578625748434e533871686d546f32654f365a717642796b70524e574367704f57627871395356534e3544464d74663777487041514549567546574d75496543382f4365304a504647686a43414f6d616c7a74585a51385656506762707349574d467873495273414b6b79785a2b35413370444647544a557858365358556d4c704e5171626b442f365663517371532b7655464145645273413232344937505436573577637a4679434472316a3336646c2b316847334f53366279454b6935617376484131693949383466384136476a454a62503362643863664e765176394e3538654474752b4f506d336f582b6d382b5043567a4d354b635738746a7857597a4e6d4d2f7045796d79337142676b5055696749324b567754555544384f496955524778544731746e32477a44535753526a73506e44744b6b6e574b39624a46374778726c575938555157335a32336648487a62304c2f54656648673762766a6a357436462f7076506a78684f434e6a75626c586952372b747648326a46637374757a74752b4f506d336f582b6d382b5042474534496e63334b76456a33396254375269755757494949304e6c6c795359745a6b6e614d3059744270366a797157586e37354965706e41427359725a5051567a38654167514243776d416442366354464f594e32587a3951536b6179327136644c664b7a4859715752314c3072556c617a316e544649794e374f4a732f55424a737a5a6f6d5656564e397851364144555234414143493652537a4b787958736f6b473531766d4f36684e5a69477971685443436d303051486947394b462f786a4230706c485930314651427447734d414d7347457558435264624b416b51444d563077492f6e5475796a35345038536c67325358344a6b4143687874653469325245414152456241476f694d4c53645777665264584d4656434d6678487133376d4a594b55496455572b306e44562f4c66466b785a53786d684c70637a51617457795a556b4545457754545349554c464b556f61464141304141306a79324a754c4e425951552b616f36396e364d765131424248766c33527738524a4d4f6363654844514c334551445745466d467a3330686835764e4c5958377255315245756d6f37413230775a4836626d4b50646a6839556f3749644a72674a596e31563961567a697456427035566333667a3263766a676b6e74584f61346a7a556b6b7968596f5848516851414e6441686352557953363472765372334d373749354c343263684d584d3675584639507871484d442f414b6a6e507342476c6e566d467a7156376a454c6d6e4b5946616d6154506367745556503730384a2f50554c304348305a6562725952506f4d4c664276414c456a484b636462714c6b34376d696343764a6f3575526f31442b493974545734454b416d487957754d5072427a4a45306c736b4e69686d5a6e53464c553278544230704c56334a5546425438726c55524145536a6f4777413759337463673644347a4d4e796b544755536332452b556d546f3037495768426264667761676b6378656e64455244755944783671634e73626949464b504f485a6b396d35686142376e55306179644148567376356d4a62525a535a465957464d727334684b6c6a574e4b5163613372567a31707a6d356e444f5a376c633550575541724d6c69317269697168744a74796241756969594e427471566b6b4e2b2b4736686745626259614250374d4e6d7378637a4a7a6e6536336e4f37795a425154735a45794579624a72354232623355557439496534366a625a4453464c4d5a6a4d4a752f63545362506e44313637554d7334634f46544b4b71714747356a474d59524577694f6f6949336a6a77375a485a69436b694155444f5869662b445676353272445062535443304d51714a6a6e68555469667252674251445547712f7952487a4831682b617a2b78743452576548776f71312f5476323574443135496a356a36772f4e5a2f59323849725044345556612f703337633268525736372b652b6b4e7a50504950345556366c587875325255506e497a345546482f676d50734469454e4435794d2b4642522f344a6a374134674a687676306252766177397250414d62366c3538425a7663722f38326c4166393635396e6a442b584c4e7a69356c716d6f4770476139634b66575532337450766a6d4f7a5876337869427852557434354c5873473042674330626735582f35744b412f37317a375045733473565a69486452556c5336664a436b6b71304861572b666b7a654c6452705767304f6a63313263742b634843504d724c436b70695a6461366b535432336c50507a6c4b36537433786b78344c706839636e414c625146456251386f2f4e2f4b5a764e5a444d3230366b637964532b594d6c43724e6e5456597953794b67446344454f5551456f683551474b4b5a576556475651334f694d795947565435714b46564e6b626d4c304276614a4135332f496d462b4679447161423264574f655139583042786b386e574e6d4f2f6133526770776c3552442f5163645838626d30396d45795630466a43446d6f365942476d6173506334756b552f77433676442f7a30792b4d492f534635327478412b67524f6a4572436e454442796f786b4663794e784c58525245376463764f5263464166385246554e44427734616877454148534c4c794f657957707051316e394f7a5a6e4d35612b54425a7338614c4656525749504178546c45514550396f3632754b426f2f456d6e3136587265514e5a744c6c395253584c715133516368673578446866517852415138734c614c6c7148704a5478566656374f6d79475532506b415444526c5830506754786b6a7a53627835703059454e507a416650544f36615a6b6f5447356d65724b59585433557a7455674c4f30556a42595371676652796e6251514e7a72434f707443782f6e48626b386350735870436646374a2f505a634a585947575049415841476135754a69747a6d31624b65564653785145625854414c5238387775524372384f3935716e432f65716d70306c3146476d7a74503252656d35536833596766574b4730485357774361455468586a4a6948677650776e74435478566d63776744706f7063375a3055504656534851335459644442636243456535565035685a39396f4a702b6f505876474c474d3973425a374b4443475a5766576c4c7a57426f46634643394375634368766f6131624d39555572556c46543135544658534e374a35737755464a797a65496d5356534e393554644168714138424151454e4936754b344a31546c6a7a39552b336f3346575370553158715358556d4c6b696855334a542f414f6b6343466c53694f6f6f4b41504562414e74754d4b356d736b6d4c57573132744e487a5161686f38796c6b4a2b785348715a414562464b35543146412f4469496b45527355776a6f44736b4e72494f644a436135727a445564682f77434854746173566f4c4c544b7a635171486a585a53526a686a67527a696f62504d454545464c446256467973636c394a4b62334f74387865377a69614632566b4b6151553232626333454e354f482b4f594f6b6865353644635641474b414d326253587445574442716932624e307970496f6f6b4169615a43685970536c4451414141734142483145514b416d4d494141616949786c444d4c6e7770484437656157777333577061684a644e5237746254426d62385252377363504955646b4f6b31774573494762546c3947723750474c3244554f594436353261566e724d7863326643446c626f7156724f6f63366a63422f7743414d2f3841452f467567634871664e5556657a394667674e775151446e7548527738524a4d4e546a772b344c33455144574a7a5a684d3656665978693570326e4257706d6b7a33494c5246542b387643663668514f67512b6a4c7a64624474324159533157316c58474b6c55476e6c5654642f5070302f4f4352424e6335684552357161535a5173554c6a6f516f4147756752703342374a49796c4d6a4e696c6d636e61464c553078544230704c563349494b436e30433556456534674f67624252366f4e3758494f676a436e38524d56396968786f503170367437507958325873396b3668684d70363844782f654e59723569645a484b4e312f465a44594e5941346b5935546a726652636f48636b546756354e484e794e476f667848747a6a5734454b416d487957754d616b6e64525a584f54316c4f3039564c572b4b617146794e796247386b45776366474b7953472f4562714741644e734e41546d59626c495773756b35734b4d70556f5370716e32684262646669746752564f547033524551376b41366a315534645547397741673834634576333736617656356c4d337137783236554d7375345855465252565177334d59786a584577694f6f694f6f7779624e35507155694a6a6f38335837634e2b786b3362724b394832694b6f53422f78754d41622f534f76594f4c3656374e6a4d4a6d6e78627a4a54766671366e596f796c425154734a47794555324c547943424c33555059645644694a7452414c426f4367676768724f4844714764683035534570476f4d6d46764650565a797a5573515151526d627731582b53492b592b73507a5766324e76434b7a772b4646577636642b334e6f65764a45664d66574835725037473368465a346643697258394f2f626d30562b74313338393949626d736c6b48384b4b3953723433624971487a6b5a384b436a2f414d457839676351686f664f526e776f4b50384177544832427841544466666f326a653168375765415933314c7a34437a6535582f7743625367502b39632b7a784c4f4b6d63722f41504e7051482f6575665a346c6e466b4c4965435562566279337a356d2f6661765a7559676767676e626d4d364d756d6254467a4c584e77566f366262374956314e74394948786a485a75504b596f63556c4c654f5377364274415941744662737475635843504d724c694930354d65744e544a4a3762756e6e366851636b73484f4d6b5042644d50724631414c6252533374454b593555726d737a6b6378625469537a46797766733143724e33545a557953714b6852754269484b494355514867494441374f624e77733242582f71383551313752723338376447446d543245347436634f70763067786e504d4a6b746f48474d484e525534434e4d3159653578646f702f335a3466384131435964492f3568656472636475774247573872504b697557653530506d54413768414e6c4643716d794e3143427744653069427a772f6d4a6874634c6c4d4969614b51534766794f715a4f3071476d70757a6d6b726670677331654d3169716f72454867597079694943454b696279522f414b3746466f304734366a735030574f3544614f496c7a38526b73656c437839554975493231445272784d776d7842776271495a42584d6a586c7a6b42457a5a77586e494f536750666f71686f594f4833686577674136526f484158505650615861456f624774717056644d724a37734c7855674c5045456a42595371416252776e6251514e7a72434f707443785153743644704445656e3136587261514e5a744c58486649726c3149626f4f517763346877766f596f674965574a373568636839585966627a564f466d39564c54784c714b4d396e6166737939504e4b4864694239596f6251644a62414a6f45336b492f6756646c687a55665836732f5a58624f52573768684b375275306f656d34334a4a7853713942356961473670725276766a7479656548574d6b6855786579677a3257464632426c6a7945713441796348346d4b675932725a542b5570596f434942334d41744243417772786a7844775871414a37517338565a6e4d494136614b584f3264464478465568304e3036364743343245426767776c2b55534e68584164504b4b49316b456e39616a333665646765643542597a74736d5772436e5a757163306a6d496f5237526f4f415a7835706332754a5749452f6e4f486b745637486162594f6c6d4b7a566d734971767467776c45566c6241496c4777397a41414c727274577647625a653033392b32593955324e3457496c745776733752674339756e6a424243396650465058684b7a567246534f57776b6f6c694855453743426d67364e5a70655465547a6d725577707a425444664a35684850735735664951717970704a4b6c48366a3136594554714342645530644467334b4e2b494159776863424d4961424b374d446d6a78627a49547a726a587338464f57494b4364684a4759696d785a683043556c78327a324856513469625551754157414343486e594b41686b75567667675a774e4163425436303374524f3130336a707046396d6a4870577056354a352f634271413044554755634545454d52684269434343493059676767694e47712f7952487a4831682b617a2b78743452576548776f71312f5476323574424246667264642f5066534735724a5a422f43697655712b4e32794b683835476643676f2f38457839676351515145773333364e6f33745965316e67474e3953382b41733375562f2b625367502b39632b7a784c4f43434c49575138456f3271336c766e7a4e2b2b31657a6378424242424f334d59676767694e4749637558664e6869356c736e414f4b4b6e473979526451447670432b4d59374a7a3554415739306c4c665345734f67583267445a67676a432f68335555374c70386b4b536452623237654b644b7a6b4768613447476c5a66326959665537585179377266312b6c79442f414858713356656f39554942746a6232533756723862422f7448706f4949516353684c7438744362675350657836364a556745344e6d544e4e6c4c7731722b51547245535770646a74527347717a355a307a5241556e327755544343795677415444596536414947754e7832724145454545443877634f77384241765a38354f7251544e55765735572b4a53685645316f61436c774a424e4d4271314e2f2f5a
, FlEntered='2014-08-10 17:00:00'
where FlTournament=-1
and FlCode='GBR'";

	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-10 17:00:00');
}

if($version<'2014-08-13 13:00:00') {
	$q="ALTER TABLE  `Countries` CHANGE  `CoTournament`  `CoTournament` INT( 10 ) NOT NULL DEFAULT  '0';";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-13 13:00:00');
}

if($version<'2014-08-15 18:00:00') {
	$q="ALTER TABLE  `TVContents` ADD  `TVCTimestamp` TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-15 18:00:00');
}

if($version<'2014-08-16 23:00:00') {
	$q="ALTER TABLE DistanceInformation drop primary key";
	$r=safe_w_sql($q,false,array(1060));
	$q="ALTER TABLE DistanceInformation add primary key (DiTournament, DiSession, DiDistance, DiType)";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-16 23:00:00');
}

if($version<'2014-08-22 16:00:00') {
	$q="ALTER TABLE `Awards` change `AwDescription` AwDescription Text NOT NULL DEFAULT '' ";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-22 16:00:00');
}

if($version<'2014-08-24 14:00:00') {
	$q="ALTER TABLE `Awards` add `AwEventTrans` varchar(255) NOT NULL DEFAULT '' ";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-08-24 14:00:00');
}

if($version<'2014-09-16 12:00:00') {
	$r=safe_w_sql("update ClubTeamGrid set CTGRound=4 where CTGRound=3",false,array(1060));
	$r=safe_w_sql("update ClubTeamGrid set CTGRound=3 where CTGRound=1 and CTGPhase=1",false,array(1060));
	$r=safe_w_sql("update ClubTeamGrid set CTGRound=1 where CTGRound=4",false,array(1060));

	db_save_version('2014-09-16 12:00:00');
}

if($version<'2014-09-17 16:00:00') {
	$q="ALTER TABLE ClubTeamScore ADD CTSSetPoints int NOT NULL, Add CTSSetEnds varchar(36) ";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-09-17 16:00:00');
}

if($version<'2014-09-18 16:00:00') {
	$q="ALTER TABLE ClubTeamScore ADD CTSDateTime datetime NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE ClubTeam ADD CTSchedule datetime NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-09-18 16:00:00');
}

if($version<'2014-09-18 19:00:00') {
	$q="ALTER TABLE ClubTeam ADD CTQualRank INT(11) NOT NULL ";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-09-18 19:00:00');
}

if($version<'2014-09-20 15:20:00') {
	// update the ClubTeam with the secondary: groups by 4 ranked 1-4, 5-8
	// lets start with 32 teams doing the secondary...
	for($n=0; $n<8; $n++) {
		$Group=$n+1;
		$Offset = $n*4 ;
		$q="insert into ClubTeamGrid (CTGPhase, CtgRound, CtgMatchNo1, CtgMatchNo2, CtgGroup) values
			(0, 1, ".($Offset +1).", ".($Offset +4).", $Group),
			(0, 1, ".($Offset +2).", ".($Offset +3).", $Group),
			(0, 2, ".($Offset +1).", ".($Offset +3).", $Group),
			(0, 2, ".($Offset +2).", ".($Offset +4).", $Group),
			(0, 3, ".($Offset +1).", ".($Offset +2).", $Group),
			(0, 3, ".($Offset +3).", ".($Offset +4).", $Group)
			";
		$r=safe_w_sql($q,false,array(1060));
	}

	db_save_version('2014-09-20 15:20:00');
}

if($version<'2014-09-22 18:00:00') {
	$q="ALTER TABLE ClubTeamScore ADD CTSTimeStamp DATETIME NOT NULL ";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-09-22 18:00:00');
}


if($version<'2014-11-02 10:20:00') {
	$q="ALTER TABLE `Entries` CHANGE `EnCode` `EnCode` VARCHAR(25) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE `LookUpEntries` CHANGE `LueCode` `LueCode` VARCHAR(25) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-11-02 10:20:00');
}

if($version<'2014-11-08 09:00:00') {
	$q="truncate table CasGrid";
	$r=safe_w_sql($q,false,array(1060));
	$q="INSERT INTO `CasGrid` VALUES ('1', '1', '1', '16', '1'), ('1', '1', '2', '15', '2'), ('1', '1', '3', '14', '3'), ('1', '1', '4', '13', '4'), ('1', '1', '5', '9', '4'), ('1', '1', '6', '10', '3'), ('1', '1', '7', '11', '2'), ('1', '1', '8', '12', '1'), ('1', '2', '1', '12', '1'), ('1', '2', '2', '11', '2'), ('1', '2', '3', '10', '3'), ('1', '2', '4', '9', '4'), ('1', '2', '5', '13', '4'), ('1', '2', '6', '14', '3'), ('1', '2', '7', '15', '2'), ('1', '2', '8', '16', '1'), ('1', '3', '1', '8', '1'), ('1', '3', '2', '7', '2'), ('1', '3', '3', '6', '3'), ('1', '3', '4', '5', '4'), ('1', '3', '9', '13', '4'), ('1', '3', '10', '14', '3'), ('1', '3', '11', '15', '2'), ('1', '3', '12', '16', '1'), ('2', '1', '1', '8', '1'), ('2', '1', '7', '2', '2'), ('2', '1', '3', '6', '3'), ('2', '1', '4', '5', '4'), ('2', '1', '9', '13', '4'), ('2', '1', '10', '14', '3'), ('2', '1', '15', '11', '2'), ('2', '1', '12', '16', '1'), ('2', '2', '1', '16', '1'), ('2', '2', '7', '11', '2'), ('2', '2', '3', '10', '3'), ('2', '2', '4', '9', '4'), ('2', '2', '5', '13', '4'), ('2', '2', '6', '14', '3'), ('2', '2', '15', '2', '2'), ('2', '2', '12', '8', '1'), ('2', '3', '1', '12', '1'), ('2', '3', '7', '15', '2'), ('2', '3', '3', '14', '3'), ('2', '3', '4', '13', '4'), ('2', '3', '5', '9', '4'), ('2', '3', '6', '10', '3'), ('2', '3', '2', '11', '2'), ('2', '3', '8', '16', '1');";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-11-08 09:00:00');
}

if($version<'2014-11-13 14:40:00') {
	$q="ALTER TABLE `Finals`
		CHANGE `FinArrowstring` `FinArrowstring` VARCHAR(30) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
		CHANGE `FinTiebreak` `FinTiebreak` VARCHAR(10) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
		CHANGE `FinArrowPosition` `FinArrowPosition` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
		CHANGE `FinTiePosition` `FinTiePosition` TINYTEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	$q="ALTER TABLE `TeamFinals`
		CHANGE `TfArrowstring` `TfArrowstring` VARCHAR(90) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
		CHANGE `TfTiebreak` `TfTiebreak` VARCHAR(30) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
		CHANGE `TfArrowPosition` `TfArrowPosition` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
		CHANGE `TfTiePosition` `TfTiePosition` TINYTEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL";
	$r=safe_w_sql($q,false,array(1060));

	db_save_version('2014-11-13 14:40:00');
}

if($version<'2014-11-16 11:35:00') {
	$q="SELECT ToId FROM Tournament ";
	$r=safe_r_sql($q);
	if (safe_num_rows($r)>0) {
		while ($row=safe_fetch($r))
			UpdateArrowPosition_20141115($row->ToId);
	}
	db_save_version('2014-11-16 11:35:00');
}

